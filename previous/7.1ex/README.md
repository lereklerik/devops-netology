# Домашнее задание к занятию "7.1. Инфраструктура как код"

## Задача 1

-----------------------------------------------------------------------------------------
<details>
<summary>Легенда</summary>
<fieldset>Через час совещание на котором менеджер расскажет о новом проекте. Начать работу над которым надо будет уже сегодня. На данный момент известно, что это будет сервис, который ваша компания будет предоставлять внешним заказчикам. Первое время, скорее всего, будет один внешний клиент, со временем внешних клиентов станет больше.

Так же по разговорам в компании есть вероятность, что техническое задание еще не четкое, что приведет к большому количеству небольших релизов, тестирований интеграций, откатов, доработок, то есть скучно не будет.

Вам, как девопс инженеру, будет необходимо принять решение об инструментах для организации инфраструктуры.

<h5>На данный момент в вашей компании уже используются следующие инструменты:</h5> 
<ol type="a">
    <li>остатки Сloud Formation,</li>
    <li>некоторые образы сделаны при помощи Packer,</li>
    <li>год назад начали активно использовать Terraform,</li>
    <li>разработчики привыкли использовать Docker,</li>
    <li>уже есть большая база Kubernetes конфигураций,</li>
    <li>для автоматизации процессов используется Teamcity,</li>
    <li>также есть совсем немного Ansible скриптов,</li>
    <li>и ряд bash скриптов для упрощения рутинных задач.</li>  
</ol>

<b>Для этого в рамках совещания надо будет выяснить подробности о проекте, чтобы в итоге определиться с инструментами:</b>

<ol>
<li>Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?</li>
<li>Будет ли центральный сервер для управления инфраструктурой?</li>
<li>Будут ли агенты на серверах?</li>
<li>Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?</li>
</ol>
В связи с тем, что проект стартует уже сегодня, в рамках совещания надо будет определиться со всеми этими вопросами.
</fieldset>
</details>

-----------------------------------------------------------------------------------------
        1.  Ответить на четыре вопроса представленных в разделе "Легенда".
        2.  Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?
        3.  Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта?
    
    Если для ответа на эти вопросы недостаточно информации, то напишите какие моменты уточните на совещании.

-----------------------------------------------------------------------------------------

1. **Какой тип инфраструктуры будем использовать для этого проекта: изменяемый или не изменяемый?**
* _Оба варианта_. Учитывая, что есть информация о нечеткости ТЗ и предполагается большое количество релизов. Проект новый, к нему придется искать подход с обеих сторон. После всех отладок, на этапе поддержки он, скорее всего, будет уже неизменяемым.
2. **Будет ли центральный сервер для управления инфраструктурой?**
* _Пока без него_. Наверное не стоит переносить проект сразу под управление `Kubernetes`, который предполагает наличие центрального сервера. Возможно это будет избыточным решением, или его использование потребуется уже на этапе поддержки.
3. **Будут ли агенты на серверах?**
* _Нет_. При частой отладке, в новом проекте агенты могут на некоторое время осложнить задачи или увеличить сроки сдачи проекта. Если на этапе поддержки перейти к `Kubernetes`, то будут и агенты, которые следят за тем, чтобы контейнеры были запущены в поде. 
4. **Будут ли использованы средства для управления конфигурацией или инициализации ресурсов?**
* _Оба варианта_. Ответ аналогичен ответу на первый вопрос. С ресурсами необходимо будет определиться, поэтому ими придется управлять, как и конфигурацией. В процессе разработки перечень ресурсов будет определен. Вероятнее всего, на этапе поддержки уже необходимо будет управлять только конфигурацией. Всегда есть нюансы =)

#### Какие инструменты из уже используемых вы хотели бы использовать для нового проекта?
* _Ansible, Docker, Terraform, Teamcity_. Не уверена, что на первом этапе не обойдется без Packer и bash-скриптов, с которыми можно было бы сделать 'набросок' сервиса, проверив некоторые настройки и особенности работы в определенной среде.
#### Хотите ли рассмотреть возможность внедрения новых инструментов для этого проекта?
* Зависит от масштаба проекта, его цели. Может быть необходимо мониторить ресурсы и логи, использовать `zabbix`, `mongoDB`, `ELK`

-----------------------------------------------------------------------------------------
## Задача 2

Установите терраформ при помощи менеджера пакетов используемого в вашей операционной системе. В виде результата этой задачи приложите вывод команды `terraform --version`.

-----------------------------------------------------------------------------------------
```shell
$ terraform -version
Terraform v1.0.8
on linux_amd64
```

-----------------------------------------------------------------------------------------
## Задача 3. Поддержка легаси кода.
    В какой-то момент вы обновили терраформ до новой версии, например с 0.12 до 0.13. А код одного из проектов настолько устарел, что не может работать с версией 0.13. В связи с этим необходимо сделать так, чтобы вы могли одновременно использовать последнюю версию терраформа установленную при помощи штатного менеджера пакетов и устаревшую версию 0.12.
    В виде результата этой задачи приложите вывод --version двух версий терраформа доступных на вашем компьютере или виртуальной машине.
-----------------------------------------------------------------------------------------
* Создадим каталоги, в которые загрузим разные версии terraform:
```shell
$ mkdir -p /usr/local/tf
$ mkdir -p /usr/local/tf/12
$ mkdir -p /usr/local/tf/13
```
* Скачаем бинарники, распакуем:
```shell
$ cd /usr/local/tf/12
$ wget https://releases.hashicorp.com/terraform/0.12.31/terraform_0.12.31_linux_amd64.zip
$ unzip terraform_0.12.31_linux_amd64.zip
$ rm terraform_0.12.31_linux_amd64.zip 

$ cd ../13
$ wget https://releases.hashicorp.com/terraform/0.13.7/terraform_0.13.7_linux_amd64.zip
$ unzip terraform_0.13.7_linux_amd64.zip 
$ rm terraform_0.13.7_linux_amd64.zip 
```
* Создадим символьные ссылки и изменим права доступа:
```shell
$ ln -s /usr/local/tf/12/terraform /usr/bin/terraform12
$ ln -s /usr/local/tf/13/terraform /usr/bin/terraform13
$ chmod ugo+x /usr/bin/terraform*
```
* **Запросим версии `terraform`**:
```shell
$ terraform12 -version
Terraform v0.12.31

Your version of Terraform is out of date! The latest version
is 1.0.8. You can update by downloading from https://www.terraform.io/downloads.html
$ terraform13 -version
Terraform v0.13.7

Your version of Terraform is out of date! The latest version
is 1.0.8. You can update by downloading from https://www.terraform.io/downloads.html

```