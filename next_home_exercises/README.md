# Домашнее задание к занятию "3.8. Компьютерные сети, лекция 3"
## 1. `ipvs`. Если при запросе на VIP сделать подряд несколько запросов (например, `for i in {1..50}; do curl -I -s 172.28.128.200>/dev/null; done `), ответы будут получены почти мгновенно. Тем не менее, в выводе `ipvsadm -Ln` еще некоторое время будут висеть активные `InActConn`. Почему так происходит?

*   В `IPVS` есть концепция виртуального сервиса с собственным адресом – **VIP (Virtual IP).**    
*   В NAT режиме адрес VIP заменяется DST одного из “real” серверов, где отвечает приложение.    
*   Так как для возврата ответа клиенту требуется обратная трансляция, в NAT режиме ответ роутится через балансировщик.

*    **Отслеживание соединений (`conntrack`)** является основной функцией сетевого стека ядра Linux. 
     >Она позволяет ядру отслеживать все логические сетевые соединения или потоки и тем самым идентифицировать все пакеты, которые составляют каждый поток, чтобы их можно было последовательно обрабатывать вместе.
*    **`Conntrack`** — это важная функция ядра, которая используется в некоторых основных случаях:
        >NAT опирается на информацию от `сonntrack`, поэтому он может одинаково обрабатывать все пакеты из одного потока.
        
        >Firewall’ы с отслеживанием состояния, опираются на информацию от `сonntrack`, чтобы добавлять “ответный” трафик в белый список. 
        Это позволяет вам написать сетевую политику, которая говорит: *«разрешить моему pod’у подключаться к любому удаленному IP-адресу»* без необходимости писать политику для явного разрешения ответного трафика.
*   Кроме того,`conntrack`обычно повышает производительность системы (снижая потребление процессорного времени и время задержек пакетов), поскольку только первый пакет в потоке должен пройти полную обработку стека сети, чтобы определить, что с ним делать.

Однако у `conntrack` есть свои ограничения.
*   Таблица`conntrack`имеет настраиваемый максимальный размер, и, если она заполняется, 
    соединения обычно начинают отклоняться или прерываться. Для обработки трафика большинства приложений 
    в таблице достаточно свободного места, и это никогда не превратится в проблему. 
    Тем не менее, есть несколько сценариев, при которых стоит задуматься об использовании таблицы `conntrack`:
    >   **Наиболее очевидный случай**, если ваш сервер обрабатывает чрезвычайно большое количество единовременно активных соединений. Например, если ваша таблица`conntrack`настроена на 128k записей, но у вас есть > 128k одновременных подключений;
    
    >   **Немного менее очевидный случай**: если ваш сервер обрабатывает очень большое количество соединений в секунду. Даже если соединения кратковременные, *они продолжают отслеживаться Linux в течение некоторого периода времени (по умолчанию 120с)*. 
        Например, если ваша таблица`conntrack`настроена на 128 тыс. записей и вы пытаетесь обработать 1100 подключений в секунду, они будут превышать размер таблицы `conntrack`, даже если соединения очень недолговечны (128k / 120с = 1092 соединений / с).

